"use strict";__filename="pages/options_popup.js",define(["require","exports","./async_bg","./options_base"],function(n,t,e,u){var o,i,r,c,l,f,s,a,h,v,p,d,m,g,w,_,b,R,y,O,k,x,j,P,T,L,E,U,z,A,D,H,M,S,$;Object.defineProperty(t,"__esModule",{value:true}),r="",c=0,l=true,f=null,s=null,h=0,v=/^[a-z][\+\-\.\da-z]+:\/\//,p=e.$("#state-action"),d=e.$("#saveOptions"),g=(m=p.nextElementSibling).nextElementSibling,w=Object.create(null),b=function(n,t){return e.y(n,t)||""},R=(function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.lt=function(e,u){n.prototype.lt.call(this,t.Rn(),u)},t.prototype.yt=function(n){return n.kt=n.gt.pattern&&w[n.gt.pattern]||false,T(n.kt)},t.prototype.G=function(e){var o,i,r;n.prototype.G.call(this,e),this.G=null,t.prototype.yt=u.s.prototype.yt,o=this.at.filter(function(n){return n.xt}),c=(i=o.length>0)?2:1,i?(r=o[0].bt,y(true)):(this.lt("",false),r=this.at[this.at.length-1].bt),setTimeout(function(){r.focus()},67)},t.prototype.tt=function(t){var e=n.prototype.tt.call(this,t),u=j("".concat(o.tabId,"/reset/silent"));return Promise.all([e,u]).then(function(n){return n[0]})},t.prototype.St=function(t,e,u){var o,i=t.gt.pattern===e,r=t.kt;n.prototype.St.call(this,t,e,u),o=e?u?u.length>1&&"^"===u[0]?b("onlyHook")||"only hook such keys":b("passThrough")||"pass through such keys":b("completelyDisabled")||"completely disabled":"",t.mt.title!==e&&(t.mt.title=e),t.bt.title!==o&&(t.bt.title=o),i?t.kt=r:this.xn(t,e)},t.prototype.xn=function(n,e){var u,o=this,i=n.mt;n.pt&=-5,e&&e!==t.Rn()?(u=L(n))instanceof Promise?u.then(function(){o.xn(n,e)}):T(u)?i.title=i.style.color="":(n.pt|=4,i.style.color="red",i.title="Red text means that the pattern does not\nmatch the current URL."):i.title=i.style.color=""},t.Rn=function(){var n=i.split(/[?#]/)[0],e=n.startsWith("http:")?"^https?://"+n.split("/",3)[2].replace(/[$()*+.?\[\\\]\^{|}]/g,"\\$&")+"/":n.startsWith(location.origin+"/")?":vimium:/"+new URL(n).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(n)&&!n.startsWith("file:")?":"+n.split("/",3).join("/")+"/":":"+n;return w[e]||(w[e]=E("^"===e[0]?{t:1,v:e}:{t:2,v:e.startsWith(":vimium:")?n:e.slice(1)})),t.Rn=function(){return e},e},t})(u.s),y=function(n){var t,e;s.Y(true),t=s.at.filter(function(n){return n.xt&&(!!n.gt.pattern||!!(4&n.pt))}),e=c,c=2,Promise.all(t.map(function(n){return null!==n.kt?n.kt:L(n)})).then(function(){O(e,n,t)})},O=function(n,t,e){var u,i,c,l=3===n,s=z(!!r,e);s&&(s=x(s)),t&&(f=n>=2?s:null),u=s===f,i=!!s&&s.length>2&&"^"===s[0],p.textContent=(l?s?b("137")+b(i?"138":"139"):b("140"):b(u?"141":"142")+b(s?i?"138":"139":u?"143":"143_2")).replace(" to be","")+b("colon")+b("NS"),m.className=s?"code":"",m.textContent=s?i?s.slice(2):s:b("143_3")+b(null!==s?"144":"145"),g.textContent=null!==o.lock&&!l&&u?b("147",[b(0!==o.lock?"144":"145")]):null!==o.lock?b("148"):"",c=e.some(function(n){return!!(4&n.pt)&&(n.gt.pattern!==n._t.pattern||n.gt.passKeys!==n._t.passKeys)}),d.disabled=u&&!c,d.firstChild.data=b(l?"115_3":u&&!c?"115":"115_2")},k=function(){if(!d.disabled)return e.R(8),s.X().then(function(){e.R(0,8),c=3,A(),y(true),d.firstChild.data=b("115_3"),d.disabled=true,l=true})},x=function(n){var t,e,u;for(u of((t=(n=n.trim()).length>2&&n.startsWith("^"))&&(n=n.slice(1).trimLeft()),e=Object.create(null),n.split(" ")))e[u]=1;return(t?"^ ":"")+Object.keys(e).sort().join(" ")},j=function(n){return e.O(22,[n,o.tabId,o.frameId]).then(function(n){o.status=n[0],o.lock=n[1]})},P=function(n,t){t&&e.Kt(t);var u=t&&(t.ctrlKey||t.metaKey);j("".concat(o.tabId,"/").concat(n)).then(function(){u?(A(),y(false)):window.close()})},T=function(n){return!!n&&(2===n.t?i.startsWith(n.v)||!!r&&r.startsWith(n.v):3===n.t?n.v.p.test(i)||!!r&&n.v.p.test(r):n.v.test(i)||!!r&&n.v.test(r))},L=function(n){var t,u=n.gt.pattern,o=w[u];return o?n.kt=o instanceof Promise?o.then(function(t){return n.kt=t}):o:(t=e.O(23,u),w[u]=n.kt=t.then(function(t){return w[u]=n.kt=E(t)}))},E=function(n){return 2===n.t?{t:n.t,v:n.v}:3===n.t?{t:n.t,v:{p:e.Ot<107?new URLPattern(n.v):new URLPattern(n.v,"http://localhost",{ignoreCase:true}),s:n.v}}:{t:n.t,v:new RegExp(n.v,"")}},U=function(){var n,t,e,u=o.exclusions,i=u.rules,r=u.matchers;for(n=0,t=i.length;n<t;n++)w["__proto__"!==(e=i[n].pattern)?e:"_"]=E(r[n])},z=function(n,t){var e,u,o,c="";for(e of t)if((u=e.kt)&&(2===u.t?i.startsWith(u.v):3===u.t?u.v.p.test(i):u.v.test(i))){if(0===(o=e.gt.passKeys).length||_||"^"===o[0]&&o.length>2)return o;c+=o}return!c&&n&&i.lastIndexOf("://",5)<0&&!v.test(i)&&r?z(false,t):c||null},A=function(){a=2!==o.status?"Disable":"Enable";var n=e.$("#toggleOnce"),t=n.nextElementSibling;e.V(function(){n.firstElementChild.textContent=(b(a)||a)+(null!==o.lock?"":b("Once")),n.onclick=P.bind(null,a),m.id="state-value",t.classList.toggle("hidden",null===o.lock),null!==o.lock&&(t.firstElementChild.onclick=P.bind(null,"Reset"))})},D=function(n){var t=e.$(".options-link"),u=location.origin+"/pages/options.html";n.startsWith(u)?e.V(function(){t.nextElementSibling.remove(),t.remove()}):(t.href!==u&&e.V(function(){t.href=u}),t.onclick=function(n){e.Kt(n),e.O(15,{u:u,p:true}).then(function(){window.close()})})},H=function(){e.jn||window.addEventListener("keydown",function(n){13===n.keyCode&&n.metaKey?M(n):n.altKey&&(88===n.keyCode||null!==o.lock&&90===n.keyCode)&&!(n.ctrlKey||n.metaKey||e.Tn(n))&&(e.Kt(n),n.stopImmediatePropagation(),P(88===n.keyCode?a:"Reset"))}),(s=new R(e.$("#exclusionRules"),function(){if(l){l=false;var n=!h&&e.$("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove(),h=1)}y(c<2)})).Z()},e.O(20).then(function(n){var t,c;if(e.P((o=n).os),t=o.url,c=e.$("#blocked-msg"),e.R(1),!o.runnable)return $(c),D(t),e.V(u.p),void e.V(S);e.V(function(n){c.remove(),c=null,e.Dt(o.reduceMotion),n.textContent=o.ver},e.$("#version")),r=o.topUrl||t,i=o.frameUrl||r,_=o.exclusions.onlyFirst,u.u.S={exclusionRules:o.exclusions.defaults},u.a({exclusionRules:o.exclusions.rules}),U(),o.exclusions=null,d.onclick=k,document.addEventListener("keyup",M),D(t),A(),H(),e.V(u.p),u.e&&e.V(u.e),e.V(S)}),M=function(n){var t,e;13===n.keyCode&&((t=n.target)instanceof HTMLAnchorElement?t.hasAttribute("href")||setTimeout(function(n){n.click(),n.blur()},0,t):(n.ctrlKey||n.metaKey)&&(e=!l&&k())&&e.then(function(){setTimeout(window.close,300)}))},S=function(){var n=document.documentElement;n.classList.remove("loading"),n.style.width="",n.style.height=""},$=function(n){var t,u,i,r,c,l,f=o.url||"",s=document.body;s.innerText="",n.style.display="",n.querySelector("#version").textContent=o.ver,t=n.querySelector("#refresh-after-install"),o.tabId<0||!f||!/^(ht|s?f)tp/i.test(f)?t.remove():!e.qn&&((i=(u=navigator.userAgentData)&&(u.brands||u.uaList))?i.find(function(n){return n.brand.includes("Opera")}):/\b(Opera|OPR)\//.test(navigator.userAgent))&&/\.(google|bing|baidu)\./.test(f.split("/",4).slice(0,3).join("/"))&&(n.querySelector("#opera-warning").style.display=""),s.appendChild(n),(r=o.unknownExt)&&((c=e.$("#injection-refused")).style.display="",c.nextElementSibling.remove(),e.$("#doAllowExt").onclick=function(){this.onclick=null,e.O(21,[o.tabId,r]).then(function(){setTimeout(function(){location.reload()},0)})}),(l=e.$("#retryInject"))&&(/^(file|ftps?|https?):/.test(f)&&o.tabId>=0?l.onclick=function(n){e.Kt(n),e.O(6,o.tabId).then(function(){window.close()})}:(l.nextElementSibling.remove(),l.remove()))}});