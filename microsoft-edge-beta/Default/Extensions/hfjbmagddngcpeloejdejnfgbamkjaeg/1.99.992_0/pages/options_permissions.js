"use strict";__filename="pages/options_permissions.js",define(["require","exports","./async_bg","./options_base","./options_defs"],function(n,o,e,r,i){var t,s,u,c,f,a,l,m,d,p,v,h,_,g,w,b,P,O,U;if(Object.defineProperty(o,"__esModule",{value:true}),o.Pn=o.yn=void 0,s=e.sn.permissions,u=function(n){if(!s)return function(){return e.O(25,{module:"permissions",name:n,args:[].slice.call(arguments)})};var o=s[n];return function(){var n=[].slice.call(arguments);return new Promise(function(r){n.push(function(n){var o=e.sn.runtime.lastError;return r(o?[void 0,o]:[n,void 0]),o}),o.apply(s,n)})}},c={contains:u("contains"),request:u("request"),remove:u("remove")},f="downloads.shelf",a="chrome://new-tab-page/*",(t={"clipboard-read":"opt_clipboardRead"})[l="chrome://*/*"]="opt_chromeUrl",t[a]="opt_cNewtab",t[f]="opt_closeShelf",m=t,d=e.$("#optionalPermissionsTemplate"),p=d.content.firstElementChild,v=d.parentElement,h=[],o.yn=e.sn.runtime.getManifest(),_=o.yn.optional_permissions||[],g=(function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return __extends(o,n),o.prototype.H=function(){r.h(this.j,"change",this.E)},o.prototype.Y=function(){return h.map(function(n){return n.j.indeterminate?"1":n.j.checked?"2":"0"}).join("")},o.prototype.q=function(){return h.map(function(n){return n.C}).join("")},o.prototype.G=function(n){var o,e;for(o=0;o<h.length;o++)(e=h[o]).j.checked="2"===n[o],e.j.indeterminate="1"===n[o]},o.prototype.tt=function(n){var o,t,s,u,m=this,d=[],p=[],v={},_=1,g=function(o){var e,t=h[o],u=+n[o];if(t.C===u)return"continue";e=t.Un===a?"chrome://newtab/*":"",t.C=u,t.Un===l&&r.u.z("allBrowserUrls")!==(2===u)&&(_++,Promise.resolve(r.u.z("allBrowserUrls")).then(function(n){n!==(2===u)?r.u.J("allBrowserUrls",2===u).then(s):s()})),2===t.Cn||(u?(t.Un===f&&d.push("downloads"),(1===t.Cn?p:d).push(t.Un),e&&p.push(e),v[t.Un]=t):(_++,c.remove(1===t.Cn?{origins:e?[t.Un,e]:[t.Un]}:{permissions:t.Un===f?["downloads",t.Un]:[t.Un]}).then(function(n){var o,e=n[1],r="Can not remove the permission %o : ",u=e&&e.message||e;(e||!n[0])&&console.log(r,t.Un,u),o=t.j.parentElement,i.Rt.un(e?r.replace("%o",t.Un)+u:"",void 0,o),s()})))};for(o=0;o<h.length;o++)g(o);return t=function(n,o){var t,u,c,f=o[0],a=o[1];if((a||!f)&&console.log("Can not request permissions of %o :",n,a&&a.message||a),!f){for(u of(t=function(n){var o,t,s=v[n];return s?(s.C=0,o=s.j.parentElement,a?(t=(a&&a.message||JSON.stringify(a))+"",n.startsWith("chrome://")&&t.includes("Only permissions specified in the manifest")&&n.startsWith("chrome:")&&(t=r.t("optNeedChromeUrlFirst"),t=e.qn?t.replace("chrome","edge"):t),t=r.t("exc")+t,i.Rt.un(t,void 0,o),void e.V(function(){o.title=t})):{value:i.Rt.un("",void 0,o)}):"continue"},n))if("object"==typeof(c=t(u)))return c.value;m.Z()}s()},s=function(){--_>0||Promise.all(h.map(b)).then(function(){m.Z()})},_+=(d.length&&1)+(p.length&&1),d.length&&c.request({permissions:d}).then(t.bind(0,d)),p.length&&c.request({origins:p}).then(t.bind(0,p)),[].includes("clipboard-read")&&(u=navigator.clipboard,_++,u.readText().catch(function(){}).then(s)),s(),Promise.resolve(n)},o})(r.r),o.Pn=g,i.jt("OptionalPermissions",g),w=function(){var n,o,i,t,s,u,c=document.createDocumentFragment();for(n of h)o=n.Un,t=(i=document.importNode(p,true)).querySelector("input"),s=r.t(m[o]||"opt_".concat(o))||o,u="",o.startsWith("chrome:")&&(s=e.qn?s.replace("chrome:","edge:"):s,u=r.t("optOfChromeUrl").replace(e.qn?"chrome":"edge","edge")),t.name=o,o===a&&e.Ot<80&&(u=r.t("requireChromium",[80]),t.disabled=true,t.checked=false,i.title=r.t("invalidOption",[r.t("beforeChromium",[80])])),i.lastElementChild.textContent=s+u,(1===_.length||2===_.length&&"en"===e.m)&&i.classList.add("single"),c.appendChild(i),n.j=t;v.appendChild(c),r.h(v,"input",P,true)},b=function(n){var o=n.Cn,i=n.Un;return(2===o?Promise.resolve([1,void 0]):c.contains(1===o?{origins:[i]}:{permissions:i===f?["downloads",i]:[i]})).then(function(o){var t,s=o[0];e.Ot<72&&i===a&&(s=false),t=s?2===n.Cn?s:i!==l||r.u.z("allBrowserUrls")?2:1:0,n.C=t})},P=function(n){var o,e,r,i,t=n.target,s=h.find(function(n){return n.j===t});s&&(o=t.checked,s.Un!==l&&s.Un!==a||(r=(e=s.Un===a)?l:a,(i=h.find(function(n){return n.Un===r}))&&(e&&o&&!i.j.checked?(i.j.checked=false,i.j.indeterminate=true):!e&&o&&t.indeterminate?t.indeterminate=false:(i.j.checked=o,i.j.indeterminate=false))))},O=["downloads"],e.qn&&O.push(a),O.push("cookies"),(_=_.filter(function(n){return!O.some(function(o){return"string"==typeof o?n===o:o.test(n)})})).length||0){for(U of _)h.push({Un:U,Cn:U.includes(":")?1:0,C:0,j:null});e.V(w),Promise.all(h.map(b)).then(function(){e.V(function(){v.dataset.model="OptionalPermissions",i.Tt(v).Z()})})}else e.V(function(){e.$("#optionalPermissionsBox").style.display="none"})});