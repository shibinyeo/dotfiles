"use strict";(function(){var n,t,o,e,i=chrome,a=i.runtime,c=function(){window!==top&&parent.focus(),window.closed||window.close(),n=null},r=function(t){var o=function(t){n?n.postMessage(t):r(t),setTimeout(c,0)},e=t.t,i=t.s,a=t.d,r=t.r,u=function(){var n;switch(e){case 1:case 9:return n=(9===e?new Promise(function(n,t){var o=document.createElement("img");o.onload=function(){var e=document.createElement("canvas"),i=e.width=o.naturalWidth,a=e.height=o.naturalHeight,c=e.getContext("2d");if(c)try{c.drawImage(o,0,0,i,a),e.toBlob(function(o){return o?n(o):t("Can not export from canvas")})}catch(n){t("Can not export tainted canvas")}else t("Can not create canvas")},o.onerror=function(){t(0)},o.src=i.u}).catch(function(n){return a||(0!==n?window.fetch(i.u):Promise.reject("Can not load image"))}):a?Promise.resolve(a):window.fetch(i.u)).then(function(n){return i.u="",n instanceof Response?n.blob():n}).then(function(n){var t,o;return i.u="",(t={})["image/png"]="image/png"===n.type?n:new Blob([n],{type:"image/png"}),o=t,i.t&&(o["text/plain"]=new Blob([i.t],{type:"text/plain"})),navigator.clipboard.write([new ClipboardItem(o)])}),9!==e&&(i.u=""),n}},f=function(){var n;try{n=u()}catch(n){}n?n.then(function(){o(s)},function(n){console.log("Vimium C: can not run task=%o:",e,n),o(false)}):o(false)},s=true;document.hasFocus()?f():(window.onfocus=f,window.focus())},u=false;if((o=(t=i.extension.getBackgroundPage)&&t())&&o.onPagesReq)(e=o.onPagesReq({i:-3,q:[]}))&&r(e);else{try{(n=a.connect({name:"384"})).onDisconnect.addListener(c)}catch(n){return void c()}n.onMessage.addListener(function(n){var t=n;49!==t.N||u?c():(u=true,r(t))})}})();