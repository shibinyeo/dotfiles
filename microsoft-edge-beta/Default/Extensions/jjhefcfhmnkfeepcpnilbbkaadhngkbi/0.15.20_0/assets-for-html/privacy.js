import"./modulepreload-polyfill.js";import{b as a}from"./browser-polyfill.js";import{d,s as o}from"./storage.js";var p=()=>Boolean(a.extension.getBackgroundPage),r=(...e)=>{d.log(...e)};const l=[];p()||a.runtime.onMessage.addListener(async(e,s)=>{const{message:t,data:g}=e;r("[Messenger]","onMessage",t,"start",g);let n;for(const u of l)if(n=await u(e,s),typeof n!="undefined")break;return r("[Messenger]","onMessage",t,"end",typeof n=="string"&&n.length>23?`${n.substr(0,20)}...`:n),n});const c=async(e,s)=>{r("[Messenger]","messageBackground",e,"start",s);const t=await a.runtime.sendMessage({message:e,data:s});return r("[Messenger]","messageBackground",e,"end",typeof t=="string"&&t.length>23?`${t.substr(0,20)}...`:t),t},i=async()=>{const e=await a.tabs.getCurrent();!e||await a.tabs.remove(e.id)},f=async()=>{const e="privacyConsent";if((await o.get([e]))[e]){await c("extension:open-install-page"),await i();return}document.querySelector("form").addEventListener("submit",t=>t.preventDefault()),document.querySelector("#approve").addEventListener("click",async t=>{t.preventDefault(),await o.set({[e]:!0}),await c("extension:open-install-page"),await i()}),document.querySelector("#refuse").addEventListener("click",async t=>{t.preventDefault(),await o.set({[e]:!1}),await i()})};f();
