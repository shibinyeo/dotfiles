"use strict";(()=>{var Tt=Object.create;var Pe=Object.defineProperty;var kt=Object.getOwnPropertyDescriptor;var St=Object.getOwnPropertyNames;var Pt=Object.getPrototypeOf,jt=Object.prototype.hasOwnProperty;var V=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Et=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of St(t))!jt.call(e,s)&&s!==r&&Pe(e,s,{get:()=>t[s],enumerable:!(o=kt(t,s))||o.enumerable});return e};var K=(e,t,r)=>(r=e!=null?Tt(Pt(e)):{},Et(t||!e||!e.__esModule?Pe(r,"default",{value:e,enumerable:!0}):r,e));var J=V((ue,je)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof ue<"u")t(je);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ue,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=o=>{let s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(s).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class u extends WeakMap{constructor(n,l=void 0){super(l),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}let p=a=>a&&typeof a=="object"&&typeof a.then=="function",d=(a,n)=>(...l)=>{o.runtime.lastError?a.reject(new Error(o.runtime.lastError.message)):n.singleCallbackArg||l.length<=1&&n.singleCallbackArg!==!1?a.resolve(l[0]):a.resolve(l)},f=a=>a==1?"argument":"arguments",x=(a,n)=>function(m,...y){if(y.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${f(n.minArgs)} for ${a}(), got ${y.length}`);if(y.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${f(n.maxArgs)} for ${a}(), got ${y.length}`);return new Promise((j,C)=>{if(n.fallbackToNoCallback)try{m[a](...y,d({resolve:j,reject:C},n))}catch(i){console.warn(`${a} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),m[a](...y),n.fallbackToNoCallback=!1,n.noCallback=!0,j()}else n.noCallback?(m[a](...y),j()):m[a](...y,d({resolve:j,reject:C},n))})},E=(a,n,l)=>new Proxy(n,{apply(m,y,j){return l.call(y,a,...j)}}),T=Function.call.bind(Object.prototype.hasOwnProperty),h=(a,n={},l={})=>{let m=Object.create(null),y={has(C,i){return i in a||i in m},get(C,i,I){if(i in m)return m[i];if(!(i in a))return;let A=a[i];if(typeof A=="function")if(typeof n[i]=="function")A=E(a,a[i],n[i]);else if(T(l,i)){let L=x(i,l[i]);A=E(a,a[i],L)}else A=A.bind(a);else if(typeof A=="object"&&A!==null&&(T(n,i)||T(l,i)))A=h(A,n[i],l[i]);else if(T(l,"*"))A=h(A,n[i],l["*"]);else return Object.defineProperty(m,i,{configurable:!0,enumerable:!0,get(){return a[i]},set(L){a[i]=L}}),A;return m[i]=A,A},set(C,i,I,A){return i in m?m[i]=I:a[i]=I,!0},defineProperty(C,i,I){return Reflect.defineProperty(m,i,I)},deleteProperty(C,i){return Reflect.deleteProperty(m,i)}},j=Object.create(a);return new Proxy(j,y)},c=a=>({addListener(n,l,...m){n.addListener(a.get(l),...m)},hasListener(n,l){return n.hasListener(a.get(l))},removeListener(n,l){n.removeListener(a.get(l))}}),S=new u(a=>typeof a!="function"?a:function(l){let m=h(l,{},{getContent:{minArgs:0,maxArgs:0}});a(m)}),w=new u(a=>typeof a!="function"?a:function(l,m,y){let j=!1,C,i=new Promise(q=>{C=function(N){j=!0,q(N)}}),I;try{I=a(l,m,C)}catch(q){I=Promise.reject(q)}let A=I!==!0&&p(I);if(I!==!0&&!A&&!j)return!1;let L=q=>{q.then(N=>{y(N)},N=>{let de;N&&(N instanceof Error||typeof N.message=="string")?de=N.message:de="An unexpected error occurred",y({__mozWebExtensionPolyfillReject__:!0,message:de})}).catch(N=>{console.error("Failed to send onMessage rejected reply",N)})};return L(A?I:i),!0}),O=({reject:a,resolve:n},l)=>{o.runtime.lastError?o.runtime.lastError.message===t?n():a(new Error(o.runtime.lastError.message)):l&&l.__mozWebExtensionPolyfillReject__?a(new Error(l.message)):n(l)},P=(a,n,l,...m)=>{if(m.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${f(n.minArgs)} for ${a}(), got ${m.length}`);if(m.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${f(n.maxArgs)} for ${a}(), got ${m.length}`);return new Promise((y,j)=>{let C=O.bind(null,{resolve:y,reject:j});m.push(C),l.sendMessage(...m)})},M={devtools:{network:{onRequestFinished:c(S)}},runtime:{onMessage:c(w),onMessageExternal:c(w),sendMessage:P.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:P.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},_={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":_},services:{"*":_},websites:{"*":_}},h(o,M,s)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var Ie=V((Bo,Ce)=>{"use strict";Ce.exports=()=>{let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}});var Ne=V((Do,Me)=>{"use strict";var Ot=Ie();function Ct(e,t="maxAge"){let r,o,s,u=async()=>{if(r!==void 0)return;let f=async x=>{s=Ot();let E=x[1][t]-Date.now();if(E<=0){e.delete(x[0]),s.resolve();return}return r=x[0],o=setTimeout(()=>{e.delete(x[0]),s&&s.resolve()},E),typeof o.unref=="function"&&o.unref(),s.promise};try{for(let x of e)await f(x)}catch{}r=void 0},p=()=>{r=void 0,o!==void 0&&(clearTimeout(o),o=void 0),s!==void 0&&(s.reject(void 0),s=void 0)},d=e.set.bind(e);return e.set=(f,x)=>{e.has(f)&&e.delete(f);let E=d(f,x);return r&&r===f&&p(),u(),E},u(),e}Me.exports=Ct});var Ue=V((Lo,Re)=>{"use strict";var It=Ne(),ge=class{constructor(t,r){if(this.maxAge=t,this[Symbol.toStringTag]="Map",this.data=new Map,It(this.data),r)for(let[o,s]of r)this.set(o,s)}get size(){return this.data.size}clear(){this.data.clear()}delete(t){return this.data.delete(t)}has(t){return this.data.has(t)}get(t){let r=this.data.get(t);if(r)return r.data}set(t,r){return this.data.set(t,{maxAge:Date.now()+this.maxAge,data:r}),this}values(){return this.createIterator(t=>t[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(t=>[t[0],t[1].data])}forEach(t,r){for(let[o,s]of this.entries())t.apply(r,[s,o,this])}[Symbol.iterator](){return this.entries()}*createIterator(t){for(let r of this.data.entries())yield t(r)}};Re.exports=ge});var k=K(J());var ce=K(J());var Ro=`https://chrome.google.com/webstore/detail/${ce.default.runtime.id}`;var Ee=[{title:"gpt-4",model:"gpt-4",defaultSelected:!1,description:"More capable than any GPT-3.5 model, able to do more complex tasks, and optimized for chat. Will be updated with our latest model iteration.",maxTokens:8192,trainingData:"Up to Sep 2021",endpoint:"https://api.openai.com/v1/chat/completions",providers:["api"]},{title:"gpt-4-0314",model:"gpt-4-0314",defaultSelected:!1,description:"Snapshot of gpt-4 from March 14th 2023. Unlike gpt-4, this model will not receive updates, and will only be supported for a three month period ending on June 14th 2023.",maxTokens:8192,trainingData:"Up to Sep 2021",endpoint:"https://api.openai.com/v1/chat/completions",providers:["api"]},{title:"gpt-4-32k",model:"gpt-4-32k",defaultSelected:!1,description:"Same capabilities as the base gpt-4 mode but with 4x the context length. Will be updated with our latest model iteration.",maxTokens:32768,trainingData:"Up to Sep 2021",endpoint:"https://api.openai.com/v1/chat/completions",providers:["api"]},{title:"gpt-4-32k-0314",model:"gpt-4-32k-0314",defaultSelected:!1,description:"Snapshot of gpt-4-32 from March 14th 2023. Unlike gpt-4-32k, this model will not receive updates, and will only be supported for a three month period ending on June 14th 2023.",maxTokens:32768,trainingData:"Up to Sep 2021",endpoint:"https://api.openai.com/v1/chat/completions",providers:["api"]},{title:"gpt-3.5-turbo",model:"gpt-3.5-turbo",defaultSelected:!0,description:"Most capable GPT-3.5 model and optimized for chat at 1/10th the cost of text-davinci-003. Will be updated with our latest model iteration.",maxTokens:4096,trainingData:"Up to Sep 2021",endpoint:"https://api.openai.com/v1/chat/completions",providers:["api"]},{title:"gpt-3.5-turbo-0301",model:"gpt-3.5-turbo-0301",defaultSelected:!1,description:"Snapshot of gpt-3.5-turbo from March 1st 2023. Unlike gpt-3.5-turbo, this model will not receive updates, and will only be supported for a three month period ending on June 1st 2023.",maxTokens:4096,trainingData:"Up to Sep 2021",endpoint:"https://api.openai.com/v1/chat/completions",providers:["api"]},{title:"text-davinci-003",model:"text-davinci-003",defaultSelected:!1,description:"Can do any language task with better quality, longer output, and consistent instruction-following than the curie, babbage, or ada models. Also supports inserting completions within text.",maxTokens:4097,trainingData:"Up to Jun 2021",endpoint:"https://api.openai.com/v1/completions",providers:["api"]},{title:"text-davinci-002",model:"text-davinci-002",defaultSelected:!1,description:"Similar capabilities to text-davinci-003 but trained with supervised fine-tuning instead of reinforcement learning",maxTokens:4097,trainingData:"Up to Jun 2021",endpoint:"https://api.openai.com/v1/completions",providers:["api"]},{title:"code-davinci-002",model:"code-davinci-002",defaultSelected:!1,description:"Optimized for code-completion tasks",maxTokens:8001,trainingData:"Up to Jun 2021",endpoint:"https://api.openai.com/v1/completions",providers:["api"]},{title:"Default (GPT-3.5)",model:"text-davinci-002-render-sha",defaultSelected:!0,maxTokens:4097,description:"Optimized for speed, currently available to Plus users",providers:["web"],endpoint:"https://chat.openai.com/backend-api/conversation"},{title:"Legacy (GPT-3.5)",model:"text-davinci-002-render-paid",defaultSelected:!1,maxTokens:4097,description:"The previous ChatGPT Plus model",providers:["web"],endpoint:"https://chat.openai.com/backend-api/conversation"},{title:"GPT-4",model:"gpt-4",defaultSelected:!1,maxTokens:4095,description:`Our most advanced model, available to Plus subscribers.

GPT-4 excels at tasks that require advanced reasoning, complex instruction understanding, and more creativity.`,providers:["web"],endpoint:"https://chat.openai.com/backend-api/conversation"}];async function Oe(){return ce.default.storage.local.get({provider:"web",model:"text-davinci-002-render-sha",apiKey:""})}var ht=K(Ue());var H,Mt=new Uint8Array(16);function xe(){if(!H&&(H=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!H))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return H(Mt)}var b=[];for(let e=0;e<256;++e)b.push((e+256).toString(16).slice(1));function Be(e,t=0){return(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase()}var Nt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ae={randomUUID:Nt};function Rt(e,t,r){if(Ae.randomUUID&&!t&&!e)return Ae.randomUUID();e=e||{};let o=e.random||(e.rng||xe)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){r=r||0;for(let s=0;s<16;++s)t[r+s]=o[s];return t}return Be(o)}var Z=Rt;function De(e){let t,r,o,s,u,p,d;return f(),{feed:x,reset:f};function f(){t=!0,r="",o=0,s=-1,u=void 0,p=void 0,d=""}function x(T){r=r?r+T:T,t&&Ut(r)&&(r=r.slice(Le.length)),t=!1;let h=r.length,c=0,S=!1;for(;c<h;){S&&(r[c]===`
`&&++c,S=!1);let w=-1,O=s,P;for(let M=o;w<0&&M<h;++M)P=r[M],P===":"&&O<0?O=M-c:P==="\r"?(S=!0,w=M-c):P===`
`&&(w=M-c);if(w<0){o=h-c,s=O;break}else o=0,s=-1;E(r,c,O,w),c+=w+1}c===h?r="":c>0&&(r=r.slice(c))}function E(T,h,c,S){if(S===0){d.length>0&&(e({type:"event",id:u,event:p||void 0,data:d.slice(0,-1)}),d="",u=void 0),p=void 0;return}let w=c<0,O=T.slice(h,h+(w?S:c)),P=0;w?P=S:T[h+c+1]===" "?P=c+2:P=c+1;let M=h+P,_=S-P,a=T.slice(M,M+_).toString();if(O==="data")d+=a?"".concat(a,`
`):`
`;else if(O==="event")p=a;else if(O==="id"&&!a.includes("\0"))u=a;else if(O==="retry"){let n=parseInt(a,10);Number.isNaN(n)||e({type:"reconnect-interval",value:n})}}}var Le=[239,187,191];function Ut(e){return Le.every((t,r)=>e.charCodeAt(r)===t)}var Bt=typeof global=="object"&&global&&global.Object===Object&&global,Y=Bt;var Dt=typeof self=="object"&&self&&self.Object===Object&&self,Lt=Y||Dt||Function("return this")(),v=Lt;var Wt=v.Symbol,W=Wt;var We=Object.prototype,Ft=We.hasOwnProperty,_t=We.toString,$=W?W.toStringTag:void 0;function qt(e){var t=Ft.call(e,$),r=e[$];try{e[$]=void 0;var o=!0}catch{}var s=_t.call(e);return o&&(t?e[$]=r:delete e[$]),s}var Fe=qt;var $t=Object.prototype,Gt=$t.toString;function zt(e){return Gt.call(e)}var _e=zt;var Vt="[object Null]",Kt="[object Undefined]",qe=W?W.toStringTag:void 0;function Jt(e){return e==null?e===void 0?Kt:Vt:qe&&qe in Object(e)?Fe(e):_e(e)}var U=Jt;function Ht(e){return e!=null&&typeof e=="object"}var F=Ht;var Zt=Array.isArray,$e=Zt;function Yt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Q=Yt;var Qt="[object AsyncFunction]",Xt="[object Function]",er="[object GeneratorFunction]",tr="[object Proxy]";function rr(e){if(!Q(e))return!1;var t=U(e);return t==Xt||t==er||t==Qt||t==tr}var X=rr;var or=v["__core-js_shared__"],ee=or;var Ge=function(){var e=/[^.]+$/.exec(ee&&ee.keys&&ee.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function ar(e){return!!Ge&&Ge in e}var ze=ar;var sr=Function.prototype,nr=sr.toString;function ir(e){if(e!=null){try{return nr.call(e)}catch{}try{return e+""}catch{}}return""}var B=ir;var fr=/[\\^$.*+?()[\]{}|]/g,lr=/^\[object .+?Constructor\]$/,mr=Function.prototype,pr=Object.prototype,dr=mr.toString,ur=pr.hasOwnProperty,cr=RegExp("^"+dr.call(ur).replace(fr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function gr(e){if(!Q(e)||ze(e))return!1;var t=X(e)?cr:lr;return t.test(B(e))}var Ve=gr;function xr(e,t){return e?.[t]}var Ke=xr;function Ar(e,t){var r=Ke(e,t);return Ve(r)?r:void 0}var R=Ar;var hr=R(v,"WeakMap"),te=hr;var yr=9007199254740991;function br(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=yr}var re=br;function vr(e){return e!=null&&re(e.length)&&!X(e)}var Je=vr;var wr=Object.prototype;function Tr(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||wr;return e===r}var oe=Tr;var kr="[object Arguments]";function Sr(e){return F(e)&&U(e)==kr}var he=Sr;var He=Object.prototype,Pr=He.hasOwnProperty,jr=He.propertyIsEnumerable,Er=he(function(){return arguments}())?he:function(e){return F(e)&&Pr.call(e,"callee")&&!jr.call(e,"callee")},Ze=Er;function Or(){return!1}var Ye=Or;var et=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Qe=et&&typeof module=="object"&&module&&!module.nodeType&&module,Cr=Qe&&Qe.exports===et,Xe=Cr?v.Buffer:void 0,Ir=Xe?Xe.isBuffer:void 0,Mr=Ir||Ye,tt=Mr;var Nr="[object Arguments]",Rr="[object Array]",Ur="[object Boolean]",Br="[object Date]",Dr="[object Error]",Lr="[object Function]",Wr="[object Map]",Fr="[object Number]",_r="[object Object]",qr="[object RegExp]",$r="[object Set]",Gr="[object String]",zr="[object WeakMap]",Vr="[object ArrayBuffer]",Kr="[object DataView]",Jr="[object Float32Array]",Hr="[object Float64Array]",Zr="[object Int8Array]",Yr="[object Int16Array]",Qr="[object Int32Array]",Xr="[object Uint8Array]",eo="[object Uint8ClampedArray]",to="[object Uint16Array]",ro="[object Uint32Array]",g={};g[Jr]=g[Hr]=g[Zr]=g[Yr]=g[Qr]=g[Xr]=g[eo]=g[to]=g[ro]=!0;g[Nr]=g[Rr]=g[Vr]=g[Ur]=g[Kr]=g[Br]=g[Dr]=g[Lr]=g[Wr]=g[Fr]=g[_r]=g[qr]=g[$r]=g[Gr]=g[zr]=!1;function oo(e){return F(e)&&re(e.length)&&!!g[U(e)]}var rt=oo;function ao(e){return function(t){return e(t)}}var ot=ao;var at=typeof exports=="object"&&exports&&!exports.nodeType&&exports,G=at&&typeof module=="object"&&module&&!module.nodeType&&module,so=G&&G.exports===at,ye=so&&Y.process,no=function(){try{var e=G&&G.require&&G.require("util").types;return e||ye&&ye.binding&&ye.binding("util")}catch{}}(),be=no;var st=be&&be.isTypedArray,io=st?ot(st):rt,nt=io;function fo(e,t){return function(r){return e(t(r))}}var it=fo;var lo=it(Object.keys,Object),ft=lo;var mo=Object.prototype,po=mo.hasOwnProperty;function uo(e){if(!oe(e))return ft(e);var t=[];for(var r in Object(e))po.call(e,r)&&r!="constructor"&&t.push(r);return t}var lt=uo;var co=R(v,"Map"),ae=co;var go=R(v,"DataView"),se=go;var xo=R(v,"Promise"),ne=xo;var Ao=R(v,"Set"),ie=Ao;var mt="[object Map]",ho="[object Object]",pt="[object Promise]",dt="[object Set]",ut="[object WeakMap]",ct="[object DataView]",yo=B(se),bo=B(ae),vo=B(ne),wo=B(ie),To=B(te),D=U;(se&&D(new se(new ArrayBuffer(1)))!=ct||ae&&D(new ae)!=mt||ne&&D(ne.resolve())!=pt||ie&&D(new ie)!=dt||te&&D(new te)!=ut)&&(D=function(e){var t=U(e),r=t==ho?e.constructor:void 0,o=r?B(r):"";if(o)switch(o){case yo:return ct;case bo:return mt;case vo:return pt;case wo:return dt;case To:return ut}return t});var gt=D;var ko="[object Map]",So="[object Set]",Po=Object.prototype,jo=Po.hasOwnProperty;function Eo(e){if(e==null)return!0;if(Je(e)&&($e(e)||typeof e=="string"||typeof e.splice=="function"||tt(e)||nt(e)||Ze(e)))return!e.length;var t=gt(e);if(t==ko||t==So)return!e.size;if(oe(e))return!lt(e).length;for(var r in e)if(jo.call(e,r))return!1;return!0}var ve=Eo;async function*xt(e){let t=e.getReader();try{for(;;){let{done:r,value:o}=await t.read();if(r)return;yield o}}finally{t.releaseLock()}}async function z(e,t){var p,d;let{onMessage:r,...o}=t,s=await fetch(e,o);if(!s.ok){let f=await s.json().catch(()=>({}));throw new Error(ve(f)?`${s.status} ${s.statusText}`:f.message||((p=f.detail)==null?void 0:p.message)||f.detail||f.message||((d=f==null?void 0:f.error)==null?void 0:d.message))}let u=De(f=>{f.type==="event"&&r(f.data)});if(!s.body)throw new Error("No response body");for await(let f of xt(s.body)){let x=new TextDecoder().decode(f);u.feed(x)}}async function ke(e,t,r,o){return fetch(`https://chat.openai.com/backend-api${r}`,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:o===void 0?void 0:JSON.stringify(o)})}async function yt(e,t){await ke(e,"POST","/conversation/message_feedback",t)}async function Oo(e,t,r){await ke(e,"PATCH",`/conversation/${t}`,r)}var we="accessToken",Te=new ht.default(10*1e3);async function le(){if(Te.get(we))return Te.get(we);let e=await fetch("https://chat.openai.com/api/auth/session");if(e.status===403)throw new Error("CLOUDFLARE");let t=await e.json().catch(()=>({}));if(!t.accessToken)throw new Error("UNAUTHORIZED");return Te.set(we,t.accessToken),t.accessToken}var At=0,fe=class{constructor(t,r){this.token=t;this.model=r;this.token=t,this.model=r,console.log("ChatGPTProvider.model",r)}async fetchModels(){return(await ke(this.token,"GET","/models").then(r=>r.json())).models}async getModelName(){if(this.model)return this.model;try{let t=await this.fetchModels();return console.log("models",t),t[0].slug}catch(t){return console.error(t),"text-davinci-002-render"}}async generateAnswer(t){var u;let r,o=()=>{At=Date.now(),r&&Oo(this.token,r,{is_visible:!1})};(u=t.signal)==null||u.addEventListener("abort",o,{once:!0});let s=await this.getModelName();return At+3e3>Date.now()&&await new Promise(p=>setTimeout(p,3e3)),await z("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({action:"next",messages:[{id:Z(),role:"user",content:{content_type:"text",parts:[t.prompt]}}],model:s,parent_message_id:Z()}),onMessage(p){var x,E,T,h,c,S,w;if(p==="[DONE]"){(x=t.signal)!=null&&x.aborted||t.onEvent({type:"done"}),o();return}let d;try{d=JSON.parse(p)}catch(O){return}if(((T=(E=d.message)==null?void 0:E.author)==null?void 0:T.role)==="user")return;let f=(S=(c=(h=d.message)==null?void 0:h.content)==null?void 0:c.parts)==null?void 0:S[0];f&&(r=d.conversation_id,(w=t.signal)!=null&&w.aborted||t.onEvent({type:"answer",data:{text:f,messageId:d.message.id,conversationId:d.conversation_id}}))}}),{cleanup:o}}};var me=class{constructor(t,r){this.token=t;this.model=r;this.token=t,this.model=r,console.log("OpenAIProvider.model",r)}async generateLegacyAnswers(t){let r="";return await z("https://api.openai.com/v1/completions",{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({model:this.model,stream:!0,prompt:t.prompt,max_tokens:100}),onMessage(o){if(o==="[DONE]"){t.signal.aborted||t.onEvent({type:"done"});return}try{let s=JSON.parse(o);r+=s.choices[0].text||"",t.signal.aborted||t.onEvent({type:"answer",data:{text:r,messageId:s.id,conversationId:s.id}})}catch(s){console.error(s)}}}),{}}async generateConversationAnswers(t){let r="";return await z("https://api.openai.com/v1/chat/completions",{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({messages:[{role:"user",content:t.prompt}],model:this.model,stream:!0}),onMessage(o){var s,u;if(o==="[DONE]"){t.signal.aborted||t.onEvent({type:"done"});return}try{let p=JSON.parse(o),d=p.choices[0].delta.content||"";if(((u=(s=p.message)==null?void 0:s.author)==null?void 0:u.role)==="user")return;r+=d,t.signal.aborted||t.onEvent({type:"answer",data:{text:r,messageId:p.id,conversationId:p.id}})}catch(p){console.error(p);return}}}),{}}async generateAnswer(t){let r=Ee.find(o=>o.model===this.model);if(!r)throw new Error("Unknown model");return r.endpoint.endsWith("/v1/chat/completions")?this.generateConversationAnswers(t):this.generateLegacyAnswers(t)}};var pe=K(J());async function bt(e){let t=await Se(e),{[t]:r}=await pe.default.storage.session.get(t).catch(()=>({}));return r}async function vt(e,t){let r=await Se(e);return pe.default.storage.session.set({[r]:t}).catch(()=>({}))}async function wt(e){let t=await Se(e);return pe.default.storage.session.remove(t).catch(()=>({}))}async function Se(e){let t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(u=>u.toString(16).padStart(2,"0")).join("")}async function Io(e,t){let r=await Oe(),o;if(r.provider==="web"){let x=await le();o=new fe(x,r.model)}else if(r.provider==="api")o=new me(r.apiKey,r.model);else throw new Error(`Unknown provider ${r.provider}`);let s=new AbortController,u;e.onDisconnect.addListener(()=>{s.abort(),u&&u()});let p=await bt(t);if(p){e.postMessage(p),e.postMessage({type:"done"});return}let d;u=(await o.generateAnswer({prompt:t,signal:s.signal,async onEvent(x){switch(x.type){case"answer":{d=x;break}case"done":{d&&await vt(t,d);break}}return e.postMessage(x)}})).cleanup}k.default.runtime.onConnect.addListener(e=>{e.onMessage.addListener(async t=>{try{await Io(e,t.question)}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return;e.postMessage({type:"error",data:r instanceof Error?r.message:r})}})});k.default.runtime.onMessage.addListener(async e=>{switch(e.type){case"FEEDBACK":{let t=await le();await yt(t,e.data);return}case"OPEN_OPTIONS_PAGE":{await k.default.runtime.openOptionsPage();return}case"GET_ACCESS_TOKEN":return le();case"RETRY":{await wt(e.question);return}default:console.warn("Unknown message type: ",e.type,e.data)}});k.default.runtime.onInstalled.addListener(async e=>{if(e.reason==="install"&&k.default.tabs.create({url:"welcome/index.html"}),e.reason==="install"){let t=`https://chrome.google.com/webstore/detail/${k.default.runtime.id}/support`;k.default.runtime.setUninstallURL(t)}if(e.previousVersion)switch(e.previousVersion){case"1.0.4":case"1.0.5":case"1.0.6":{let{provider:t}=await k.default.storage.local.get("provider");(t==="gpt3"||t==="chatgpt")&&await k.default.storage.local.set({provider:"free",model:null,"provider:gpt3":null,"provider:chatgpt":null})}}Mo()});async function Mo(){let e=await k.default.tabs.query({windowType:"normal"});for(let t of e)t.id&&t.url&&!t.url.startsWith("chrome")&&!t.url.startsWith("https://chrome.google.com/webstore")&&await k.default.scripting.executeScript({target:{tabId:t.id,allFrames:!1},files:["content-script/index.js"]}).catch(r=>{})}k.default.action.onClicked.addListener(e=>{e.id&&k.default.tabs.sendMessage(e.id,{type:"OPEN_POPUP"})});})();
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
